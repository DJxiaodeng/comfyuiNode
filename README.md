# ComfyUI 图片信息查看节点

## 项目简介

这是一个用于 ComfyUI 的自定义节点，可以查看图片的元数据信息，包括标签、种子、Lora 等。该节点可以帮助用户分析 AI 生成图片的参数和设置，便于复现或调整生成结果。

## 功能特点

- 提取并显示图片基本信息（尺寸、格式、模式）
- 解析 PNG 元数据，包括生成参数
- 提取正面提示词和负面提示词
- 显示生成参数（种子、采样器、步数、CFG 值等）
- 提取模型信息和哈希值
- 识别并列出使用的 Lora 模型及其权重
- 支持将提取的信息保存到文本文件

## 安装方法

1. 确保已安装 ComfyUI
2. 将 `image_info_node.py` 文件复制到 ComfyUI 的自定义节点目录中（通常为 `ComfyUI/custom_nodes/` 目录）
3. 重启 ComfyUI

## 使用方法

1. 在 ComfyUI 工作流中添加「图片信息查看器」节点
2. 将需要分析的图片连接到节点的 `image` 输入端
3. 运行工作流，查看输出的信息
4. 可选：设置 `save_to_file` 为 `True` 将信息保存到文件

## 节点参数说明

### 输入参数

| 参数名 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| image | IMAGE | 是 | 需要分析的图片 |
| save_to_file | BOOLEAN | 否 | 是否将信息保存到文件（默认：False） |
| output_path | STRING | 否 | 保存信息的文件路径（默认："image_info.txt"） |

### 输出参数

| 参数名 | 类型 | 说明 |
| --- | --- | --- |
| info | STRING | 提取的图片信息文本 |

## 输出信息解释

节点输出的信息包含以下几个部分：

### 图片基本信息

```
## 图片基本信息
尺寸: 512 x 512
格式: PNG
模式: RGB
```

### PNG 元数据

```
## PNG元数据
### 生成参数
[原始生成参数文本]

### 正面提示词
[正面提示词内容]

### 负面提示词
[负面提示词内容]

种子: 1234567890
采样器: Euler a
步数: 20
CFG值: 7.0
模型: modelName (abc123)

### 使用的Lora
- loraName1 (权重: 0.75)
- loraName2 (权重: 0.5)

### 其他元数据
[其他未分类的元数据信息]
```

## 技术实现细节

### 主要组件

- `ImageInfoExtractor` 类：主要的节点实现类
- `extract_info` 方法：节点的主要功能入口
- `_extract_metadata` 方法：从图像中提取元数据
- `_parse_png_metadata` 方法：解析 PNG 元数据
- `_extract_loras` 方法：提取 Lora 信息

### 工作流程

1. 接收输入图像（ComfyUI tensor 格式）
2. 将 tensor 转换为 PIL 图像
3. 提取图像的基本信息（尺寸、格式等）
4. 检查并解析 PNG 元数据
5. 从元数据中提取各种信息（提示词、参数等）
6. 特别处理 Lora 信息
7. 格式化输出信息
8. 可选：将信息保存到文件

### 元数据解析方法

节点支持两种主要的元数据格式：

1. 标准 PNG 文本块中的 `parameters` 字段
2. ComfyUI 特有的 `ComfyUI` JSON 元数据

对于 Lora 信息，节点会：

1. 从 `parameters` 字段中查找 `<lora:name:weight>` 格式的标记
2. 从元数据中查找以 `lora_` 开头的键

## 注意事项

- 该节点仅支持从 PNG 图像中提取元数据
- 不同的 AI 图像生成工具可能使用不同的元数据格式，本节点主要支持 ComfyUI 和 Stable Diffusion WebUI 生成的图像
- 如果图像没有元数据或格式不兼容，节点仍会显示基本的图像信息

## 贡献与反馈

欢迎提交问题报告和功能建议，共同改进这个节点！